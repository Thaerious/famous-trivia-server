

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>1. Overview &mdash; Famous-Trivia 2021-06-06 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="1. Log" href="4.log.html" />
    <link rel="prev" title="1. Pre-requisitesx" href="2.getting_started.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Famous-Trivia
          

          
            
            <img src="../_static/nflogo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="1.introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="1.introduction.html#quick-links">Quick Links</a></li>
<li class="toctree-l1"><a class="reference internal" href="1.introduction.html#project-layout">Project Layout</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="2.getting_started.html">1. Pre-requisitesx</a></li>
<li class="toctree-l1"><a class="reference internal" href="2.getting_started.html#installation">2. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="2.getting_started.html#documentation">3. Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Internals</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="#nidgets">2. Nidgets</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#processing-nidgets">2.1. Processing Nidgets</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#root-html-pages">3. Root HTML Pages</a></li>
<li class="toctree-l1"><a class="reference internal" href="#game-manager-endpoint">4. Game Manager Endpoint</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#launch">4.1. launch</a></li>
<li class="toctree-l2"><a class="reference internal" href="#terminate">4.2. terminate</a></li>
<li class="toctree-l2"><a class="reference internal" href="#join-game">4.3. join-game</a></li>
<li class="toctree-l2"><a class="reference internal" href="#has-game">4.4. has-game</a></li>
<li class="toctree-l2"><a class="reference internal" href="#get-game-hash">4.5. get-game-hash</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#game-description-model">5. Game Description Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="#tests">6. Tests</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#client-side-coverage">6.1. Client Side Coverage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">6.1.1. Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#instructions">6.1.2. Instructions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#index-side-coverage">6.2. Server Side Coverage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">6.2.1. Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">6.2.2. Instructions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Log</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="4.log.html">1. Log</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Famous-Trivia</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><span class="section-number">1. </span>Overview</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/chapters/3.internals.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="overview">
<h1><span class="section-number">1. </span>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h1>
<p>The program entry point is <a class="reference external" href="https://github.com/Thaerious/trivia-index/blob/master/src/index/index.js">src/index/index.js</a>.
This is where the Express webserver is setup and started.
It starts the following modules and services:</p>
<ul class="simple">
<li><p>Session manager.</p></li>
<li><p>Game manager service.</p></li>
<li><p>CORS settings.</p></li>
<li><p>Embedded JavaScript (ejs) template engine.</p></li>
<li><p>Just-In-Time (JIT) javascript browserify/babel.</p></li>
<li><p>The Websocket to listen for new connections.</p></li>
</ul>
<p><strong>Settings</strong></p>
<ul class="simple">
<li><p>Values that are not expected to change are found in: <a class="reference external" href="https://github.com/Thaerious/trivia-index/blob/master/src/constants.js">src/constants.js</a>.</p></li>
<li><p>Settings that may change are found in: <a class="reference external" href="https://github.com/Thaerious/trivia-index/blob/master/src/config.js">src/config.js</a>.</p></li>
</ul>
</div>
<div class="section" id="nidgets">
<h1><span class="section-number">2. </span>Nidgets<a class="headerlink" href="#nidgets" title="Permalink to this headline">¶</a></h1>
<p>The term “Nidget” stands for “Not-a-Widget”, which is a little tongue in cheek as it is a widget.
A Widget (and a Nidget) being a reusable GUI element.  I chose Nidget as the term Widget is used quite often
already.</p>
<p>A Nidget consists of 3 files:</p>
<ul class="simple">
<li><p>A template .ejs file.</p></li>
<li><p>A style file (either .css or .scss).</p></li>
<li><p>A .js file.</p></li>
</ul>
<p>Nidgets are a solution to automatically reusing template elements.  A template element holds HTML code
without actually inserting it into the DOM.  Each nidget template lives in it’s own .ejs file located in the
<code class="docutils literal notranslate"><span class="pre">/views/nidgets/</span></code> directory.</p>
<p><strong>Template File</strong> (/views/nidgets/check-box.ejs):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">template</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;check-box-template&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">link</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;styles/generated/check_box.css&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">div</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">div</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="o">&gt;&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">template</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The template name must match the .ejs filename with dashes between words, appended with <em>“-template”</em>.
For example the “check-box-template” above would be located in the file <em>“check-box.ejs”</em>.
The root element of a Nidget template must be the html <em>&lt;template&gt;</em> element.
It’s good practice to separate the template styling into it’s own file with a stylesheet <em>&lt;link&gt;</em> element.</p>
<p><strong>Style File</strong> (/src/styles/check-box.scss):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">:</span><span class="n">host</span><span class="p">(</span><span class="n">check</span><span class="o">-</span><span class="n">box</span><span class="o">.</span><span class="n">hidden</span><span class="p">){</span>
    <span class="n">display</span><span class="p">:</span> <span class="n">none</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">:</span><span class="n">host</span><span class="p">([</span><span class="n">nidget</span><span class="o">-</span><span class="n">disabled</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">]){</span>
    <span class="c1">#outer{</span>
        <span class="n">background</span><span class="o">-</span><span class="n">color</span><span class="p">:</span> <span class="n">var</span><span class="p">(</span><span class="o">--</span><span class="n">ui</span><span class="o">-</span><span class="n">background</span><span class="o">-</span><span class="n">disabled</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">#outer{</span>
    <span class="n">position</span><span class="p">:</span> <span class="n">absolute</span><span class="p">;</span>
    <span class="n">width</span><span class="p">:</span> <span class="mi">100</span><span class="o">%</span><span class="p">;</span>
    <span class="n">height</span><span class="p">:</span> <span class="mi">100</span><span class="o">%</span><span class="p">;</span>
    <span class="n">left</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">top</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>

    <span class="c1">#inner{</span>
        <span class="n">position</span><span class="p">:</span> <span class="n">absolute</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You can access host CSS selectors with the <em>:host</em> pseudo-class function.  It is generally good practice
to have the outermost element (besides &lt;template&gt;) contain the entirety of the encapsulating element.
Then you can position all child elements according to this <em>#outer</em> element.  The file name of the
style sheet is specified by the link (style) element in the template file.</p>
<p><strong>JavaScript File</strong> (/src/client/nidgets/check-box.js):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">NidgetElement</span> <span class="kn">from</span> <span class="s2">&quot;./NidgetElement.js&quot;</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CheckBox</span> <span class="n">extends</span> <span class="n">NidgetElement</span> <span class="p">{</span>
    <span class="n">constructor</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">super</span><span class="p">(</span><span class="s2">&quot;check-box-template&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">window</span><span class="o">.</span><span class="n">customElements</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s1">&#39;check-box&#39;</span><span class="p">,</span> <span class="n">CheckBox</span><span class="p">);</span>
<span class="n">export</span> <span class="n">default</span> <span class="n">CheckBox</span><span class="p">;</span>
</pre></div>
</div>
<p>The .js file must have the same name as the template (.ejs) file.  The name
can be either camelCase for hyphen-delimited.  The constructor needs to invoke
the super constructor, passing in the template id that was set in the template file.
The custom element gets added with the hyphenated version of the name, passing in the class
as well.</p>
<div class="section" id="processing-nidgets">
<h2><span class="section-number">2.1. </span>Processing Nidgets<a class="headerlink" href="#processing-nidgets" title="Permalink to this headline">¶</a></h2>
<p>While you could add Nidget imports manually, to prevent repetition a built
<a class="reference external" href="https://browserify.org/">browserify</a> function
is provided.  This will not only browserify (and babelify) the .ejs source file,
it will also automatically inject Nidget template (.ejs) and script (.js) files.
Perform the following steps.</p>
<p><strong>Insert templates into the .ejs files (add to all root .ejs files)</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;%-</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;../partials/nidget-templates&#39;</span><span class="p">);</span> <span class="o">%&gt;</span>
</pre></div>
</div>
<p><strong>Add the following to the Express index.</strong></p>
<p>Generate the html and js pages.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">const</span> <span class="n">nidgetPreprocessor</span> <span class="o">=</span> <span class="n">new</span> <span class="n">NidgetPreprocessor</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">ejs_nidgets</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">nidget_scripts</span><span class="p">)</span><span class="o">.</span><span class="n">setup</span><span class="p">();</span>
<span class="k">await</span> <span class="n">JITBrowserify</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">nidgetPreprocessor</span><span class="p">);</span>
</pre></div>
</div>
<p>Setup the middleware to index Browserified .js files.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">jit_path</span><span class="p">,</span> <span class="n">Express</span><span class="o">.</span><span class="n">static</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">public_scripts</span><span class="p">));</span>
</pre></div>
</div>
<p>Setup the middleware to serve rendered .ejs files.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;*.ejs&quot;</span><span class="p">,</span> <span class="n">Express</span><span class="o">.</span><span class="n">static</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">pre_ejs</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="n">setHeaders</span> <span class="p">:</span> <span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">stat</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">res</span><span class="o">.</span><span class="n">setHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/html&#39;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">));</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="root-html-pages">
<h1><span class="section-number">3. </span>Root HTML Pages<a class="headerlink" href="#root-html-pages" title="Permalink to this headline">¶</a></h1>
<p>There are 6 single page applications which serve as entry points.
These are found in the ‘/views/pages’ directory.
They are .ejs pages which compile into .html pages.
This permits the automatic injection of Nidget dependencies.</p>
<ul class="simple">
<li><p>contestant_join.ejs : the contestant enters their name to join a game.</p></li>
<li><p>editor.ejs : the host edit’s a game.</p></li>
<li><p>host.ejs : the host’s main menu where they can manage and launch games.</p></li>
<li><p>launch_console.ejs : host’s submenu to manage a launched game.</p></li>
<li><p>contestant_portal.ejs : the contestant’s game view (where they actually play).</p></li>
<li><p>host_portal.ejs : the host’s game view (where they actually play).</p></li>
</ul>
</div>
<div class="section" id="game-manager-endpoint">
<h1><span class="section-number">4. </span>Game Manager Endpoint<a class="headerlink" href="#game-manager-endpoint" title="Permalink to this headline">¶</a></h1>
<p>The GameManagerEndpoint is the main api starting point for any client interacting with the index.
The endpoint url is “HOSTNAME/game-manager-service”.  The format, exampled below, consists of
a required ‘action’ field.  Other required fields depend on the contents of the action field.  The
client has a corresponding  GameManagerService class which calls the endpoint actions.</p>
<p>All actions return a json object with the result field set to ‘success’, ‘rejected’, or ‘error’.
If the result if ‘error’ or ‘rejected’ there will also be a ‘reason’ field.
The following actions are supported:</p>
<div class="section" id="launch">
<h2><span class="section-number">4.1. </span>launch<a class="headerlink" href="#launch" title="Permalink to this headline">¶</a></h2>
<p>Launch a new game with the user as host.
The model is result from GameDescriptionModel#get().
This method will verify the user’s google credentials.
The ‘game-hash’ returned is used to connect to the game with
future API calls.
A user can only host one game at a time.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s1">&#39;action&#39;</span> <span class="p">:</span> <span class="s1">&#39;launch&#39;</span><span class="p">,</span>
  <span class="s1">&#39;model&#39;</span>  <span class="p">:</span> <span class="n">game</span><span class="o">-</span><span class="n">description</span><span class="o">-</span><span class="n">model</span><span class="p">,</span>
  <span class="s1">&#39;token&#39;</span>  <span class="p">:</span> <span class="n">google</span><span class="o">-</span><span class="n">auth</span><span class="o">-</span><span class="n">token</span>
<span class="p">}</span>
</pre></div>
</div>
<p>returns:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">res</span><span class="o">.</span><span class="n">json</span><span class="p">({</span>
    <span class="n">result</span> <span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
    <span class="nb">hash</span>   <span class="p">:</span> <span class="n">game</span><span class="o">-</span><span class="nb">hash</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="terminate">
<h2><span class="section-number">4.2. </span>terminate<a class="headerlink" href="#terminate" title="Permalink to this headline">¶</a></h2>
<p>Stop a currently running game.
This method will verify the user’s google credentials.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="n">action</span> <span class="p">:</span> <span class="s2">&quot;terminate&quot;</span><span class="p">,</span>
    <span class="n">token</span>  <span class="p">:</span> <span class="n">google</span><span class="o">-</span><span class="n">auth</span><span class="o">-</span><span class="n">token</span>
<span class="p">}</span>
</pre></div>
</div>
<p>returns:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">res</span><span class="o">.</span><span class="n">json</span><span class="p">({</span>
    <span class="n">result</span> <span class="p">:</span> <span class="s2">&quot;success&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="join-game">
<h2><span class="section-number">4.3. </span>join-game<a class="headerlink" href="#join-game" title="Permalink to this headline">¶</a></h2>
<p>Create a contestant with the given name.
The contestant will be associated with the current session.
Each session can only have one contestant.
The host can not also be a contestant.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s1">&#39;action&#39;</span>    <span class="p">:</span> <span class="s2">&quot;join-game&quot;</span><span class="p">,</span>
    <span class="s1">&#39;game-hash&#39;</span> <span class="p">:</span> <span class="n">game</span><span class="o">-</span><span class="nb">hash</span><span class="p">,</span>
    <span class="s1">&#39;name&#39;</span>      <span class="p">:</span> <span class="n">string</span>
<span class="p">}</span>
</pre></div>
</div>
<p>returns:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="n">result</span> <span class="p">:</span> <span class="s1">&#39;success&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="has-game">
<h2><span class="section-number">4.4. </span>has-game<a class="headerlink" href="#has-game" title="Permalink to this headline">¶</a></h2>
<p>Determine if a user is currently hosting a game.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s1">&#39;action&#39;</span> <span class="p">:</span> <span class="s1">&#39;has-game&#39;</span><span class="p">,</span>
  <span class="s1">&#39;token&#39;</span>  <span class="p">:</span> <span class="n">google</span><span class="o">-</span><span class="n">auth</span><span class="o">-</span><span class="n">token</span>
<span class="p">}</span>
</pre></div>
</div>
<p>returns:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="n">result</span> <span class="p">:</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span>
    <span class="nb">hash</span>   <span class="p">:</span> <span class="n">game</span><span class="o">-</span><span class="nb">hash</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="get-game-hash">
<h2><span class="section-number">4.5. </span>get-game-hash<a class="headerlink" href="#get-game-hash" title="Permalink to this headline">¶</a></h2>
<p>Determine if the current session has been associated with a game (see join-game).:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s1">&#39;action&#39;</span>    <span class="p">:</span> <span class="s2">&quot;get-game-hash&quot;</span>
    <span class="s1">&#39;game-hash&#39;</span> <span class="p">:</span> <span class="n">game</span><span class="o">-</span><span class="nb">hash</span>
<span class="p">}</span>
</pre></div>
</div>
<p>returns:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="n">result</span> <span class="p">:</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span>
    <span class="nb">hash</span>   <span class="p">:</span> <span class="n">game</span><span class="o">-</span><span class="nb">hash</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="game-description-model">
<h1><span class="section-number">5. </span>Game Description Model<a class="headerlink" href="#game-description-model" title="Permalink to this headline">¶</a></h1>
<p>The game description model (src/client/GameDescriptionModel.js) stores the questions for
a trivia game.  GameDescriptionModel#get() returns the json version of the model.  The
GameDescriptionModel class is just a helper class to manipulate the json.  The root object
(shown below) contains the game name and an array of rounds.  There are currently two flavours
of rounds, with the option to easily add more.</p>
<p>json root:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="n">name</span> <span class="p">:</span> <span class="n">string</span><span class="p">,</span>
    <span class="n">rounds</span> <span class="p">:</span> <span class="p">[{},</span> <span class="o">...</span><span class="p">,</span> <span class="p">{}]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Jeopardy style round:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nb">type</span> <span class="p">:</span> <span class="s2">&quot;categorical&quot;</span><span class="p">,</span>
    <span class="n">column</span> <span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="n">category</span> <span class="p">:</span> <span class="n">string</span><span class="p">,</span>
            <span class="n">font</span><span class="o">-</span><span class="n">size</span> <span class="p">:</span> <span class="n">string</span><span class="p">,</span>
            <span class="n">cell</span> <span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="n">value</span> <span class="p">:</span> <span class="n">number</span><span class="p">,</span>
                    <span class="nb">type</span> <span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span>
                    <span class="n">q</span> <span class="p">:</span> <span class="n">string</span><span class="p">,</span>
                    <span class="n">a</span> <span class="p">:</span> <span class="n">string</span>
                <span class="p">}</span>
            <span class="p">]</span> <span class="n">x</span> <span class="mi">5</span>
        <span class="p">},</span>
    <span class="p">]</span> <span class="n">x</span> <span class="mi">6</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Multiple choice round:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nb">type</span> <span class="p">:</span> <span class="s2">&quot;multiple_choice&quot;</span><span class="p">,</span>
    <span class="n">bonus</span> <span class="p">:</span> <span class="n">number</span><span class="p">,</span>
    <span class="n">question</span> <span class="p">:</span> <span class="n">string</span><span class="p">,</span>
    <span class="n">answers</span> <span class="p">:</span> <span class="p">[</span>
        <span class="n">string_1</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">string_6</span>
    <span class="p">],</span>
    <span class="n">values</span> <span class="p">:</span> <span class="p">[</span>
        <span class="n">boolean_1</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">boolean_6</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="tests">
<h1><span class="section-number">6. </span>Tests<a class="headerlink" href="#tests" title="Permalink to this headline">¶</a></h1>
<div class="section" id="client-side-coverage">
<h2><span class="section-number">6.1. </span>Client Side Coverage<a class="headerlink" href="#client-side-coverage" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3><span class="section-number">6.1.1. </span>Overview<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Added dev packages “NYC”, and “babel-plugin-istanbul”.</p></li>
<li><p>Added [“istanbul”] to the .babelrc plugins under ‘env.test’.</p></li>
<li><p>Added ‘unsafe-eval’ to cors.  Istanbul failed without it.</p></li>
<li><p>Created a new index endpoint ‘/report-coverage’ see src/index/mechanics/ReportCoverage.js.</p></li>
<li><p>Created a new client script ‘public/scripts/static/coverage_report.js’.</p></li>
</ul>
</div>
<div class="section" id="instructions">
<h3><span class="section-number">6.1.2. </span>Instructions<a class="headerlink" href="#instructions" title="Permalink to this headline">¶</a></h3>
<p>To enable code coverage, set the ‘NODE_ENV’ environment variable to ‘test’.</p>
<ul class="simple">
<li><p>linux &amp; mac: export NODE_ENV=test</p></li>
<li><p>windows: $env:NODE_ENV = ‘test’</p></li>
</ul>
<p>Babel will add Istanbul (nyc) markup to all scripts when they are rendered by browserify.
The .ejs renderer will inject a page unload listener into all the pages (see /view/partials/head.ejs).
This listener will call the /report-coverage service and pass it the coverage file.</p>
<p>Create the report with this command:</p>
<p><code class="docutils literal notranslate"><span class="pre">npx</span> <span class="pre">nyc</span> <span class="pre">report</span> <span class="pre">--report-dir</span> <span class="pre">coverage/client</span> <span class="pre">-r</span> <span class="pre">html</span></code></p>
</div>
</div>
<div class="section" id="index-side-coverage">
<h2><span class="section-number">6.2. </span>Server Side Coverage<a class="headerlink" href="#index-side-coverage" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id2">
<h3><span class="section-number">6.2.1. </span>Overview<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>The index uses c8 instead of nyc because nyc doesn’t handle imports, but rather
handles require.</p>
<ul class="simple">
<li><p>Added dev packages “c8”</p></li>
<li><p>Requires interactive mode (-i)</p></li>
</ul>
</div>
<div class="section" id="id3">
<h3><span class="section-number">6.2.2. </span>Instructions<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>Run the index with this command (requires interactive mode -i):</p>
<p><code class="docutils literal notranslate"><span class="pre">npx</span> <span class="pre">c8</span> <span class="pre">--temp-directory</span> <span class="pre">./.c8_output/</span> <span class="pre">node</span> <span class="pre">.</span> <span class="pre">-i</span></code></p>
<p>Create the report with this command:</p>
<p><code class="docutils literal notranslate"><span class="pre">npx</span> <span class="pre">c8</span> <span class="pre">report</span> <span class="pre">--temp-directory</span> <span class="pre">.c8_output/</span> <span class="pre">--report-dir</span> <span class="pre">coverage/index</span> <span class="pre">-r</span> <span class="pre">html</span></code></p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="4.log.html" class="btn btn-neutral float-right" title="1. Log" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="2.getting_started.html" class="btn btn-neutral float-left" title="1. Pre-requisitesx" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Ed Armstrong.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>